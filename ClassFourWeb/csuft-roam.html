<!-- 
    功能概述: 给定路线起止点和途经地点的经纬度, 绘制出运动轨迹
    功能实现: 
        1. 在文件标识处键入相关地物点坐标, 即可在浏览器页面中生成对应的运动轨迹
 -->

<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="shortcut icon" type="image/x-icon" href="./fav.ico" rel="external nofollow" />
    <title>漫游林科大-运动轨迹展示</title>
    <!-- css样式文件 -->
    <style type="text/css">
        html,
        body,
        #baiduMap {
            width: 100%;
            height: 100%;
            margin: 0px;
            padding: 0px;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <!-- 地图盒子 -->
    <div id="baiduMap"></div>
    <!-- js文件 -->
    <script type="text/javascript" src="http://api.map.baidu.com/api?key=&v=1.3&services=true"></script>
    <!-- 页面js文件 -->
    <script type="text/javascript">
        // 创建示例数据
        var pointArr = [{ 
            // 地点1： 林科大东园12栋： 113.002519； 28.136849
            "lng": 113.002519,
            "lat": 28.136849
        }, {
            // 地点2： 林海餐厅： 113.001638； 28.137589
            "lng": 113.001638,
            "lat": 28.137589
        }, {
            // 地点3： 林旺百货： 113.002092； 28.137637
            "lng": 113.002092,
            "lat": 28.137637
        }, {
            // 地点4： 林科大汇贤居中通快递： 113.003862； 28.137084
            "lng": 113.003862,
            "lat": 28.137084
        }, {
            // 地点5： 一教： 113.004266； 28.13778
            "lng": 113.004266,
            "lat": 28.13778
        }, {
            // 地点6： 林科大东门益禾堂奶茶店： 113.007536； 28.138999
            "lng": 113.007536,
            "lat": 28.138999
        }, {
            // 地点7： 林科大厚街螺鼎记螺蛳粉： 113.00136； 28.137402
            "lng": 113.00136,
            "lat": 28.137402
        }, {
            // 地点8： 林科大第九教学楼： 112.997228； 28.136956
            "lng": 112.997228,
            "lat": 28.136956
        }, {
            // 地点9： 林科大林涛餐厅： 112.996787； 28.135451
            "lng": 112.996787,
            "lat": 28.135451
        }
        ];

        // 在指定容器创建地图实例并设置最大最小缩放级别 
        var map = new BMap.Map("baiduMap", {
            minZoom: 5,
            maxZoom: 19
        });

        // 初始化地图，设置中心点和显示级别
        map.centerAndZoom(new BMap.Point(113.002524, 28.136824), 20);

        // 开启鼠标滚轮缩放功能，仅对PC上有效
        map.enableScrollWheelZoom();

        // 将控件（平移缩放控件）添加到地图上
        map.addControl(new BMap.NavigationControl());

        // 地图定位到第一个点
        map.centerAndZoom(pointArr[0], 20);

        // 使用浏览器的矢量图制图工具，在地图上绘制折线的地图叠加层
        var polyline = new BMap.Polyline(pointArr, {
            strokeColor: "#0C8816",
            strokeWeight: 3,
            setStrokeStyle: "dashed",
            strokeOpacity: 1
        });

        // 将覆盖物（线）添加到地图上
        map.addOverlay(polyline);

        // 
        for (var i = 0, j = pointArr.length; i < j; i++) {
            var myIcon;
            if (i == 0) {
                myIcon = new BMap.Icon("images/start.png", new BMap.Size(32, 32), {
                    // 指定定位位置
                    offset: new BMap.Size(10, 32),
                });
            } else if (i == pointArr.length - 1) {
                myIcon = new BMap.Icon("images/end.png", new BMap.Size(32, 32), {
                    // 指定定位位置
                    offset: new BMap.Size(32, 32),
                });
            } else {
                myIcon = new BMap.Icon("images/transparent.png", new BMap.Size(32, 32), {
                    // 指定定位位置
                    offset: new BMap.Size(32, 32),
                });
            };
            var marker = new BMap.Marker(pointArr[i], {
                icon: myIcon
            });

            map.addOverlay(marker);
        };

        //根据经纬极值计算绽放级别。
        function getZoom(maxLng, minLng, maxLat, minLat) {
            // 级别18到3。
            var zoom = ["50", "100", "200", "500", "1000", "2000", "5000", "10000", "20000", "25000", "50000", "100000", "200000", "500000", "1000000", "2000000"];
            // 创建点坐标A
            var pointA = new BMap.Point(maxLng, maxLat);
            // 创建点坐标B
            var pointB = new BMap.Point(minLng, minLat);
            //获取两点距离,保留小数点后两位
            var distance = map.getDistance(pointA, pointB).toFixed(1);
            for (var i = 0, zoomLen = zoom.length; i < zoomLen; i++) {
                if (zoom[i] - distance > 0) {
                    //之所以会多3，是因为地图范围常常是比例尺距离的10倍以上。所以级别会增加3。
                    return 18 - i + 3;
                }
            }
        };

        // 判断最大和最小经纬度
        function setZoom(points) {
            if (points.length > 0) {
                var maxLng = points[0].lng; // 最大经度
                var minLng = points[0].lng; // 最小经度
                var maxLat = points[0].lat; // 最大维度
                var minLat = points[0].lat; // 最小维度
                var res;
                for (var i = points.length - 1; i >= 0; i--) {
                    res = points[i];
                    if (res.lng > maxLng) maxLng = res.lng;
                    if (res.lng < minLng) minLng = res.lng;
                    if (res.lat > maxLat) maxLat = res.lat;
                    if (res.lat < minLat) minLat = res.lat;
                }
                var cenLng = (parseFloat(maxLng) + parseFloat(minLng)) / 2;
                var cenLat = (parseFloat(maxLat) + parseFloat(minLat)) / 2;
                var zoom = getZoom(maxLng, minLng, maxLat, minLat);
                map.centerAndZoom(new BMap.Point(cenLng, cenLat), zoom);
            } 
            // else {
            //     //没有坐标，显示全中国
            //     map.centerAndZoom(new BMap.Point(103.388611, 35.563611), 5);
            // }
        };

        setZoom(pointArr);
    </script>
</body>

</html>